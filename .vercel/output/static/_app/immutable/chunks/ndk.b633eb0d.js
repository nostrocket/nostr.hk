var Ft=Object.defineProperty;var It=(n,t,e)=>t in n?Ft(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var g=(n,t,e)=>(It(n,typeof t!="symbol"?t+"":t,e),e);import{w as _t}from"./index.06520791.js";import{n as zt,a as P,b as Rt,r as Bt,s as Nt,m as Tt,g as Ut,c as ut,d as Dt}from"./nostr.5a67cad7.js";var B={},Ht={get exports(){return B},set exports(n){B=n}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(h,u,i){this.fn=h,this.context=u,this.once=i||!1}function o(h,u,i,a,l){if(typeof i!="function")throw new TypeError("The listener must be a function");var w=new r(i,a||h,l),y=e?e+u:u;return h._events[y]?h._events[y].fn?h._events[y]=[h._events[y],w]:h._events[y].push(w):(h._events[y]=w,h._eventsCount++),h}function f(h,u){--h._eventsCount===0?h._events=new s:delete h._events[u]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],i,a;if(this._eventsCount===0)return u;for(a in i=this._events)t.call(i,a)&&u.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(i)):u},c.prototype.listeners=function(u){var i=e?e+u:u,a=this._events[i];if(!a)return[];if(a.fn)return[a.fn];for(var l=0,w=a.length,y=new Array(w);l<w;l++)y[l]=a[l].fn;return y},c.prototype.listenerCount=function(u){var i=e?e+u:u,a=this._events[i];return a?a.fn?1:a.length:0},c.prototype.emit=function(u,i,a,l,w,y){var m=e?e+u:u;if(!this._events[m])return!1;var p=this._events[m],C=arguments.length,k,S;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),C){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,i),!0;case 3:return p.fn.call(p.context,i,a),!0;case 4:return p.fn.call(p.context,i,a,l),!0;case 5:return p.fn.call(p.context,i,a,l,w),!0;case 6:return p.fn.call(p.context,i,a,l,w,y),!0}for(S=1,k=new Array(C-1);S<C;S++)k[S-1]=arguments[S];p.fn.apply(p.context,k)}else{var z=p.length,I;for(S=0;S<z;S++)switch(p[S].once&&this.removeListener(u,p[S].fn,void 0,!0),C){case 1:p[S].fn.call(p[S].context);break;case 2:p[S].fn.call(p[S].context,i);break;case 3:p[S].fn.call(p[S].context,i,a);break;case 4:p[S].fn.call(p[S].context,i,a,l);break;default:if(!k)for(I=1,k=new Array(C-1);I<C;I++)k[I-1]=arguments[I];p[S].fn.apply(p[S].context,k)}}return!0},c.prototype.on=function(u,i,a){return o(this,u,i,a,!1)},c.prototype.once=function(u,i,a){return o(this,u,i,a,!0)},c.prototype.removeListener=function(u,i,a,l){var w=e?e+u:u;if(!this._events[w])return this;if(!i)return f(this,w),this;var y=this._events[w];if(y.fn)y.fn===i&&(!l||y.once)&&(!a||y.context===a)&&f(this,w);else{for(var m=0,p=[],C=y.length;m<C;m++)(y[m].fn!==i||l&&!y[m].once||a&&y[m].context!==a)&&p.push(y[m]);p.length?this._events[w]=p.length===1?p[0]:p:f(this,w)}return this},c.prototype.removeAllListeners=function(u){var i;return u?(i=e?e+u:u,this._events[i]&&f(this,i)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=e,c.EventEmitter=c,n.exports=c})(Ht);/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const E=BigInt(0),v=BigInt(1),R=BigInt(2),q=BigInt(3),ht=BigInt(8),A=Object.freeze({a:E,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:v,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),ft=(n,t)=>(n+t/R)/t,W={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(n){const{n:t}=A,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-v*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),r=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=e,f=BigInt("0x100000000000000000000000000000000"),c=ft(o*n,t),h=ft(-s*n,t);let u=d(n-c*e-h*r,t),i=d(-c*s-h*o,t);const a=u>f,l=i>f;if(a&&(u=t-u),l&&(i=t-i),u>f||i>f)throw new Error("splitScalarEndo: Endomorphism failed, k="+n);return{k1neg:a,k1:u,k2neg:l,k2:i}}},D=32,j=32,lt=D+1,dt=2*D+1;function pt(n){const{a:t,b:e}=A,s=d(n*n),r=d(s*n);return d(r+t*n+e)}const Y=A.a===E;class Ot extends Error{constructor(t){super(t)}}function gt(n){if(!(n instanceof b))throw new TypeError("JacobianPoint expected")}class b{constructor(t,e,s){this.x=t,this.y=e,this.z=s}static fromAffine(t){if(!(t instanceof x))throw new TypeError("JacobianPoint#fromAffine: expected Point");return t.equals(x.ZERO)?b.ZERO:new b(t.x,t.y,v)}static toAffineBatch(t){const e=qt(t.map(s=>s.z));return t.map((s,r)=>s.toAffine(e[r]))}static normalizeZ(t){return b.toAffineBatch(t).map(b.fromAffine)}equals(t){gt(t);const{x:e,y:s,z:r}=this,{x:o,y:f,z:c}=t,h=d(r*r),u=d(c*c),i=d(e*u),a=d(o*h),l=d(d(s*c)*u),w=d(d(f*r)*h);return i===a&&l===w}negate(){return new b(this.x,d(-this.y),this.z)}double(){const{x:t,y:e,z:s}=this,r=d(t*t),o=d(e*e),f=d(o*o),c=t+o,h=d(R*(d(c*c)-r-f)),u=d(q*r),i=d(u*u),a=d(i-R*h),l=d(u*(h-a)-ht*f),w=d(R*e*s);return new b(a,l,w)}add(t){gt(t);const{x:e,y:s,z:r}=this,{x:o,y:f,z:c}=t;if(o===E||f===E)return this;if(e===E||s===E)return t;const h=d(r*r),u=d(c*c),i=d(e*u),a=d(o*h),l=d(d(s*c)*u),w=d(d(f*r)*h),y=d(a-i),m=d(w-l);if(y===E)return m===E?this.double():b.ZERO;const p=d(y*y),C=d(y*p),k=d(i*p),S=d(m*m-C-R*k),z=d(m*(k-S)-l*C),I=d(r*c*y);return new b(S,z,I)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=b.ZERO;if(typeof t=="bigint"&&t===E)return e;let s=mt(t);if(s===v)return this;if(!Y){let a=e,l=this;for(;s>E;)s&v&&(a=a.add(l)),l=l.double(),s>>=v;return a}let{k1neg:r,k1:o,k2neg:f,k2:c}=W.splitScalar(s),h=e,u=e,i=this;for(;o>E||c>E;)o&v&&(h=h.add(i)),c&v&&(u=u.add(i)),i=i.double(),o>>=v,c>>=v;return r&&(h=h.negate()),f&&(u=u.negate()),u=new b(d(u.x*W.beta),u.y,u.z),h.add(u)}precomputeWindow(t){const e=Y?128/t+1:256/t+1,s=[];let r=this,o=r;for(let f=0;f<e;f++){o=r,s.push(o);for(let c=1;c<2**(t-1);c++)o=o.add(r),s.push(o);r=o.double()}return s}wNAF(t,e){!e&&this.equals(b.BASE)&&(e=x.BASE);const s=e&&e._WINDOW_SIZE||1;if(256%s)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&rt.get(e);r||(r=this.precomputeWindow(s),e&&s!==1&&(r=b.normalizeZ(r),rt.set(e,r)));let o=b.ZERO,f=b.BASE;const c=1+(Y?128/s:256/s),h=2**(s-1),u=BigInt(2**s-1),i=2**s,a=BigInt(s);for(let l=0;l<c;l++){const w=l*h;let y=Number(t&u);t>>=a,y>h&&(y-=i,t+=v);const m=w,p=w+Math.abs(y)-1,C=l%2!==0,k=y<0;y===0?f=f.add(G(C,r[m])):o=o.add(G(k,r[p]))}return{p:o,f}}multiply(t,e){let s=mt(t),r,o;if(Y){const{k1neg:f,k1:c,k2neg:h,k2:u}=W.splitScalar(s);let{p:i,f:a}=this.wNAF(c,e),{p:l,f:w}=this.wNAF(u,e);i=G(f,i),l=G(h,l),l=new b(d(l.x*W.beta),l.y,l.z),r=i.add(l),o=a.add(w)}else{const{p:f,f:c}=this.wNAF(s,e);r=f,o=c}return b.normalizeZ([r,o])[0]}toAffine(t){const{x:e,y:s,z:r}=this,o=this.equals(b.ZERO);t==null&&(t=o?ht:tt(r));const f=t,c=d(f*f),h=d(c*f),u=d(e*c),i=d(s*h),a=d(r*f);if(o)return x.ZERO;if(a!==v)throw new Error("invZ was invalid");return new x(u,i)}}b.BASE=new b(A.Gx,A.Gy,v);b.ZERO=new b(E,v,E);function G(n,t){const e=t.negate();return n?e:t}const rt=new WeakMap;class x{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,rt.delete(this)}hasEvenY(){return this.y%R===E}static fromCompressedHex(t){const e=t.length===32,s=U(e?t:t.subarray(1));if(!nt(s))throw new Error("Point is not on curve");const r=pt(s);let o=Mt(r);const f=(o&v)===v;e?f&&(o=d(-o)):(t[0]&1)===1!==f&&(o=d(-o));const c=new x(s,o);return c.assertValidity(),c}static fromUncompressedHex(t){const e=U(t.subarray(1,D+1)),s=U(t.subarray(D+1,D*2+1)),r=new x(e,s);return r.assertValidity(),r}static fromHex(t){const e=it(t),s=e.length,r=e[0];if(s===D)return this.fromCompressedHex(e);if(s===lt&&(r===2||r===3))return this.fromCompressedHex(e);if(s===dt&&r===4)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-${lt} compressed bytes or ${dt} uncompressed bytes, not ${s}`)}static fromPrivateKey(t){return x.BASE.multiply(ot(t))}static fromSignature(t,e,s){const{r,s:o}=Kt(e);if(![0,1,2,3].includes(s))throw new Error("Cannot recover: invalid recovery bit");const f=jt(it(t)),{n:c}=A,h=s===2||s===3?r+c:r,u=tt(h,c),i=d(-f*u,c),a=d(o*u,c),l=s&1?"03":"02",w=x.fromHex(l+O(h)),y=x.BASE.multiplyAndAddUnsafe(w,i,a);if(!y)throw new Error("Cannot recover signature: point at infinify");return y.assertValidity(),y}toRawBytes(t=!1){return T(this.toHex(t))}toHex(t=!1){const e=O(this.x);return t?`${this.hasEvenY()?"02":"03"}${e}`:`04${e}${O(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:s}=this;if(!nt(e)||!nt(s))throw new Error(t);const r=d(s*s),o=pt(e);if(d(r-o)!==E)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new x(this.x,d(-this.y))}double(){return b.fromAffine(this).double().toAffine()}add(t){return b.fromAffine(this).add(b.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return b.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,s){const r=b.fromAffine(this),o=e===E||e===v||this!==x.BASE?r.multiplyUnsafe(e):r.multiply(e),f=b.fromAffine(t).multiplyUnsafe(s),c=o.add(f);return c.equals(b.ZERO)?void 0:c.toAffine()}}x.BASE=new x(A.Gx,A.Gy);x.ZERO=new x(E,E);function yt(n){return Number.parseInt(n[0],16)>=8?"00"+n:n}function wt(n){if(n.length<2||n[0]!==2)throw new Error(`Invalid signature integer tag: ${Z(n)}`);const t=n[1],e=n.subarray(2,t+2);if(!t||e.length!==t)throw new Error("Invalid signature integer: wrong length");if(e[0]===0&&e[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:U(e),left:n.subarray(t+2)}}function $t(n){if(n.length<2||n[0]!=48)throw new Error(`Invalid signature tag: ${Z(n)}`);if(n[1]!==n.length-2)throw new Error("Invalid signature: incorrect length");const{data:t,left:e}=wt(n.subarray(2)),{data:s,left:r}=wt(e);if(r.length)throw new Error(`Invalid signature: left bytes after parsing: ${Z(r)}`);return{r:t,s}}class N{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=t instanceof Uint8Array,s="Signature.fromCompact";if(typeof t!="string"&&!e)throw new TypeError(`${s}: Expected string or Uint8Array`);const r=e?Z(t):t;if(r.length!==128)throw new Error(`${s}: Expected 64-byte hex`);return new N(X(r.slice(0,64)),X(r.slice(64,128)))}static fromDER(t){const e=t instanceof Uint8Array;if(typeof t!="string"&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:s,s:r}=$t(e?t:T(t));return new N(s,r)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!Q(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Q(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=A.n>>v;return this.s>t}normalizeS(){return this.hasHighS()?new N(this.r,d(-this.s,A.n)):this}toDERRawBytes(){return T(this.toDERHex())}toDERHex(){const t=yt(M(this.s)),e=yt(M(this.r)),s=t.length/2,r=e.length/2,o=M(s),f=M(r);return`30${M(r+s+4)}02${f}${e}02${o}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return T(this.toCompactHex())}toCompactHex(){return O(this.r)+O(this.s)}}function L(...n){if(!n.every(s=>s instanceof Uint8Array))throw new Error("Uint8Array list expected");if(n.length===1)return n[0];const t=n.reduce((s,r)=>s+r.length,0),e=new Uint8Array(t);for(let s=0,r=0;s<n.length;s++){const o=n[s];e.set(o,r),r+=o.length}return e}const Zt=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function Z(n){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");let t="";for(let e=0;e<n.length;e++)t+=Zt[n[e]];return t}const Lt=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function O(n){if(typeof n!="bigint")throw new Error("Expected bigint");if(!(E<=n&&n<Lt))throw new Error("Expected number 0 <= n < 2^256");return n.toString(16).padStart(64,"0")}function bt(n){const t=T(O(n));if(t.length!==32)throw new Error("Error: expected 32 bytes");return t}function M(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function X(n){if(typeof n!="string")throw new TypeError("hexToNumber: expected string, got "+typeof n);return BigInt(`0x${n}`)}function T(n){if(typeof n!="string")throw new TypeError("hexToBytes: expected string, got "+typeof n);if(n.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+n.length);const t=new Uint8Array(n.length/2);for(let e=0;e<t.length;e++){const s=e*2,r=n.slice(s,s+2),o=Number.parseInt(r,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[e]=o}return t}function U(n){return X(Z(n))}function it(n){return n instanceof Uint8Array?Uint8Array.from(n):T(n)}function mt(n){if(typeof n=="number"&&Number.isSafeInteger(n)&&n>0)return BigInt(n);if(typeof n=="bigint"&&Q(n))return n;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function d(n,t=A.P){const e=n%t;return e>=E?e:t+e}function _(n,t){const{P:e}=A;let s=n;for(;t-- >E;)s*=s,s%=e;return s}function Mt(n){const{P:t}=A,e=BigInt(6),s=BigInt(11),r=BigInt(22),o=BigInt(23),f=BigInt(44),c=BigInt(88),h=n*n*n%t,u=h*h*n%t,i=_(u,q)*u%t,a=_(i,q)*u%t,l=_(a,R)*h%t,w=_(l,s)*l%t,y=_(w,r)*w%t,m=_(y,f)*y%t,p=_(m,c)*m%t,C=_(p,f)*y%t,k=_(C,q)*u%t,S=_(k,o)*w%t,z=_(S,e)*h%t,I=_(z,R);if(I*I%t!==n)throw new Error("Cannot find square root");return I}function tt(n,t=A.P){if(n===E||t<=E)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=d(n,t),s=t,r=E,o=v;for(;e!==E;){const c=s/e,h=s%e,u=r-o*c;s=e,e=h,r=o,o=u}if(s!==v)throw new Error("invert: does not exist");return d(r,t)}function qt(n,t=A.P){const e=new Array(n.length),s=n.reduce((o,f,c)=>f===E?o:(e[c]=o,d(o*f,t)),v),r=tt(s,t);return n.reduceRight((o,f,c)=>f===E?o:(e[c]=d(o*e[c],t),d(o*f,t)),r),e}function Pt(n){const t=n.length*8-j*8,e=U(n);return t>0?e>>BigInt(t):e}function jt(n,t=!1){const e=Pt(n);if(t)return e;const{n:s}=A;return e>=s?e-s:e}let $,et;function Q(n){return E<n&&n<A.n}function nt(n){return E<n&&n<A.P}function ot(n){let t;if(typeof n=="bigint")t=n;else if(typeof n=="number"&&Number.isSafeInteger(n)&&n>0)t=BigInt(n);else if(typeof n=="string"){if(n.length!==2*j)throw new Error("Expected 32 bytes of private key");t=X(n)}else if(n instanceof Uint8Array){if(n.length!==j)throw new Error("Expected 32 bytes of private key");t=U(n)}else throw new TypeError("Expected valid private key");if(!Q(t))throw new Error("Expected private key: 0 < key < n");return t}function Kt(n){if(n instanceof N)return n.assertValidity(),n;try{return N.fromDER(n)}catch{return N.fromCompact(n)}}x.BASE._setWindowSize(8);const F={node:zt,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},V={},H={bytesToHex:Z,hexToBytes:T,concatBytes:L,mod:d,invert:tt,isValidPrivateKey(n){try{return ot(n),!0}catch{return!1}},_bigintTo32Bytes:bt,_normalizePrivateKey:ot,hashToPrivateKey:n=>{n=it(n);const t=j+8;if(n.length<t||n.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const e=d(U(n),A.n-v)+v;return bt(e)},randomBytes:(n=32)=>{if(F.web)return F.web.getRandomValues(new Uint8Array(n));if(F.node){const{randomBytes:t}=F.node;return Uint8Array.from(t(n))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>H.hashToPrivateKey(H.randomBytes(j+8)),precompute(n=8,t=x.BASE){const e=t===x.BASE?t:new x(t.x,t.y);return e._setWindowSize(n),e.multiply(q),e},sha256:async(...n)=>{if(F.web){const t=await F.web.subtle.digest("SHA-256",L(...n));return new Uint8Array(t)}else if(F.node){const{createHash:t}=F.node,e=t("sha256");return n.forEach(s=>e.update(s)),Uint8Array.from(e.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(n,...t)=>{if(F.web){const e=await F.web.subtle.importKey("raw",n,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=L(...t),r=await F.web.subtle.sign("HMAC",e,s);return new Uint8Array(r)}else if(F.node){const{createHmac:e}=F.node,s=e("sha256",n);return t.forEach(r=>s.update(r)),Uint8Array.from(s.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(n,...t)=>{let e=V[n];if(e===void 0){const s=await H.sha256(Uint8Array.from(n,r=>r.charCodeAt(0)));e=L(s,s),V[n]=e}return H.sha256(e,...t)},taggedHashSync:(n,...t)=>{if(typeof $!="function")throw new Ot("sha256Sync is undefined, you need to set it");let e=V[n];if(e===void 0){const s=$(Uint8Array.from(n,r=>r.charCodeAt(0)));e=L(s,s),V[n]=e}return $(e,...t)},_JacobianPoint:b};Object.defineProperties(H,{sha256Sync:{configurable:!1,get(){return $},set(n){$||($=n)}},hmacSha256Sync:{configurable:!1,get(){return et},set(n){et||(et=n)}}});var J={},Wt={get exports(){return J},set exports(n){J=n}},st,Et;function Yt(){if(Et)return st;Et=1;var n=1e3,t=n*60,e=t*60,s=e*24,r=s*7,o=s*365.25;st=function(i,a){a=a||{};var l=typeof i;if(l==="string"&&i.length>0)return f(i);if(l==="number"&&isFinite(i))return a.long?h(i):c(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function f(i){if(i=String(i),!(i.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(a){var l=parseFloat(a[1]),w=(a[2]||"ms").toLowerCase();switch(w){case"years":case"year":case"yrs":case"yr":case"y":return l*o;case"weeks":case"week":case"w":return l*r;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*e;case"minutes":case"minute":case"mins":case"min":case"m":return l*t;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function c(i){var a=Math.abs(i);return a>=s?Math.round(i/s)+"d":a>=e?Math.round(i/e)+"h":a>=t?Math.round(i/t)+"m":a>=n?Math.round(i/n)+"s":i+"ms"}function h(i){var a=Math.abs(i);return a>=s?u(i,a,s,"day"):a>=e?u(i,a,e,"hour"):a>=t?u(i,a,t,"minute"):a>=n?u(i,a,n,"second"):i+" ms"}function u(i,a,l,w){var y=a>=l*1.5;return Math.round(i/l)+" "+w+(y?"s":"")}return st}function Gt(n){e.debug=e,e.default=e,e.coerce=h,e.disable=o,e.enable=r,e.enabled=f,e.humanize=Yt(),e.destroy=u,Object.keys(n).forEach(i=>{e[i]=n[i]}),e.names=[],e.skips=[],e.formatters={};function t(i){let a=0;for(let l=0;l<i.length;l++)a=(a<<5)-a+i.charCodeAt(l),a|=0;return e.colors[Math.abs(a)%e.colors.length]}e.selectColor=t;function e(i){let a,l=null,w,y;function m(...p){if(!m.enabled)return;const C=m,k=Number(new Date),S=k-(a||k);C.diff=S,C.prev=a,C.curr=k,a=k,p[0]=e.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let z=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(K,kt)=>{if(K==="%%")return"%";z++;const ct=e.formatters[kt];if(typeof ct=="function"){const At=p[z];K=ct.call(C,At),p.splice(z,1),z--}return K}),e.formatArgs.call(C,p),(C.log||e.log).apply(C,p)}return m.namespace=i,m.useColors=e.useColors(),m.color=e.selectColor(i),m.extend=s,m.destroy=e.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(w!==e.namespaces&&(w=e.namespaces,y=e.enabled(i)),y),set:p=>{l=p}}),typeof e.init=="function"&&e.init(m),m}function s(i,a){const l=e(this.namespace+(typeof a>"u"?":":a)+i);return l.log=this.log,l}function r(i){e.save(i),e.namespaces=i,e.names=[],e.skips=[];let a;const l=(typeof i=="string"?i:"").split(/[\s,]+/),w=l.length;for(a=0;a<w;a++)l[a]&&(i=l[a].replace(/\*/g,".*?"),i[0]==="-"?e.skips.push(new RegExp("^"+i.slice(1)+"$")):e.names.push(new RegExp("^"+i+"$")))}function o(){const i=[...e.names.map(c),...e.skips.map(c).map(a=>"-"+a)].join(",");return e.enable(""),i}function f(i){if(i[i.length-1]==="*")return!0;let a,l;for(a=0,l=e.skips.length;a<l;a++)if(e.skips[a].test(i))return!1;for(a=0,l=e.names.length;a<l;a++)if(e.names[a].test(i))return!0;return!1}function c(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}function h(i){return i instanceof Error?i.stack||i.message:i}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Vt=Gt;(function(n,t){t.formatArgs=s,t.save=r,t.load=o,t.useColors=e,t.storage=f(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;h.splice(1,0,u,"color: inherit");let i=0,a=0;h[0].replace(/%[a-zA-Z%]/g,l=>{l!=="%%"&&(i++,l==="%c"&&(a=i))}),h.splice(a,0,u)}t.log=console.debug||console.log||(()=>{});function r(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function o(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h}function f(){try{return localStorage}catch{}}n.exports=Vt(t);const{formatters:c}=n.exports;c.j=function(h){try{return JSON.stringify(h)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Wt,J);BigInt(1e3),BigInt(1e6),BigInt(1e9),BigInt(1e12);BigInt("2100000000000000000");BigInt(1e11);const St={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27};for(let n=0,t=Object.keys(St);n<t.length;n++)t[n],St[t[n]].toString();var Xt=class extends B{constructor(t){super();g(this,"ndk");g(this,"zappedEvent");g(this,"zappedUser");this.ndk=t.ndk,this.zappedEvent=t.zappedEvent,this.zappedUser=t.zappedUser||this.ndk.getUser({hexpubkey:this.zappedEvent.pubkey})}async getZapEndpoint(){let t,e,s,r;if(this.zappedEvent){const c=(await this.zappedEvent.getMatchingTags("zap"))[0];if(c)switch(c[2]){case"lud06":t=c[1];break;case"lud16":e=c[1];break;default:throw new Error(`Unknown zap tag ${c}`)}}if(this.zappedUser&&(this.zappedUser.profile||await this.zappedUser.fetchProfile(),t=(this.zappedUser.profile||{}).lud06,e=(this.zappedUser.profile||{}).lud16),e){const[c,h]=e.split("@");s=`https://${h}/.well-known/lnurlp/${c}`}else if(t){const{words:c}=ut.decode(t,1e3),h=ut.fromWords(c);s=new TextDecoder("utf-8").decode(h)}if(!s)throw new Error("No zap endpoint found");const f=await(await fetch(s)).json();return f!=null&&f.allowsNostr&&(f!=null&&f.nostrPubkey)&&(r=f.callback),r}async createZapRequest(t,e){var u;const s=await this.getZapEndpoint();if(!s)throw new Error("No zap endpoint found");if(!this.zappedEvent)throw new Error("No zapped event found");const r=Dt.makeZapRequest({profile:this.zappedUser.hexpubkey(),event:(u=this.zappedEvent)==null?void 0:u.id,amount:t,comment:e||"",relays:["wss://nos.lol","wss://relay.nostr.band","wss://relay.f7z.io","wss://relay.damus.io","wss://nostr.mom","wss://no.str.cr"]}),o=new Ct(this.ndk,r);await o.sign();const f=await o.toNostrEvent();return(await(await fetch(`${s}?`+new URLSearchParams({amount:t.toString(),nostr:JSON.stringify(f)}))).json()).pr}};function Qt(n,t=[]){const e=/@(npub|nprofile|note)[a-zA-Z0-9]+/g;return n=n.replace(e,s=>{try{const{type:r,data:o}=P.decode(s.slice(1)),f=t.length;switch(r){case"npub":t.push(["p",o]);break;case"nprofile":t.push(["p",o.pubkey]);break;case"nevent":t.push(["e",o.id]);break;case"note":t.push(["e",o]);break}return`#[${f}]`}catch{return s}}),{content:n,tags:t}}function Jt(){if(!this.kind)throw new Error("Kind not set");return this.kind>=1e4&&this.kind<=3e4}function te(){if(!this.kind)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<=4e4}function ee(){return this.isParamReplaceable()?P.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag()}):P.noteEncode(this.tagId())}var Ct=class extends B{constructor(t,e){super();g(this,"ndk");g(this,"created_at");g(this,"content","");g(this,"subject");g(this,"tags",[]);g(this,"kind");g(this,"id","");g(this,"sig");g(this,"pubkey","");g(this,"isReplaceable",Jt.bind(this));g(this,"isParamReplaceable",te.bind(this));g(this,"encode",ee.bind(this));this.ndk=t,this.created_at=e==null?void 0:e.created_at,this.content=(e==null?void 0:e.content)||"",this.subject=e==null?void 0:e.subject,this.tags=(e==null?void 0:e.tags)||[],this.id=(e==null?void 0:e.id)||"",this.sig=e==null?void 0:e.sig,this.pubkey=(e==null?void 0:e.pubkey)||"",this.kind=e==null?void 0:e.kind}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id}}async toNostrEvent(t){var s,r;if(!t&&this.pubkey===""){const o=await((r=(s=this.ndk)==null?void 0:s.signer)==null?void 0:r.user());this.pubkey=(o==null?void 0:o.hexpubkey())||""}const e={created_at:this.created_at||Math.floor(Date.now()/1e3),content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id};this.generateTags(),this.subject&&(e.subject=this.subject);try{e.id=Ut(e)}catch{}return this.sig&&(e.sig=this.sig),e}getMatchingTags(t){return this.tags.filter(e=>e[0]===t)}async toString(){return await this.toNostrEvent()}async sign(){var e,s,r;(e=this.ndk)==null||e.assertSigner(),await this.generateTags();const t=await this.toNostrEvent();this.sig=await((r=(s=this.ndk)==null?void 0:s.signer)==null?void 0:r.sign(t))}async publish(){var t;return this.sig||await this.sign(),(t=this.ndk)==null?void 0:t.publish(this)}async generateTags(){if(this.tags.length>0){const{content:t,tags:e}=Qt(this.content,this.tags);this.content=t,this.tags=e}if(this.kind&&this.kind>=3e4&&this.kind<=4e4&&!this.getMatchingTags("d")[0]){const e=[...Array(16)].map(()=>Math.random().toString(36)[2]).join("");this.tags.push(["d",e])}}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}tagId(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}return this.id}tagReference(){return this.kind&&this.kind>=3e4&&this.kind<=4e4?["a",this.tagId()]:["e",this.tagId()]}async zap(t,e){if(!this.ndk)throw new Error("No NDK instance found");return this.ndk.assertSigner(),await new Xt({ndk:this.ndk,zappedEvent:this}).createZapRequest(t,e)}},ne=class extends B{constructor(t){super();g(this,"url");g(this,"scores");g(this,"relay");g(this,"_status");g(this,"connectedAt");g(this,"_connectionStats",{attempts:0,success:0,durations:[]});g(this,"complaining",!1);g(this,"activeSubscriptions",new Set);g(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++}});this.url=t,this.relay=Bt(t),this.scores=new Map,this._status=3,this.relay.on("connect",()=>{this.updateConnectionStats.connected(),this.emit("connect"),this._status=1}),this.relay.on("disconnect",()=>{this.updateConnectionStats.disconnected(),this.emit("disconnect"),this._status===1&&(this._status=3,this.handleReconnection())}),this.relay.on("notice",e=>this.handleNotice(e))}isFlapping(){const t=this._connectionStats.durations;if(t.length<10)return!1;const s=t.reduce((c,h)=>c+h,0)/t.length,r=t.map(c=>Math.pow(c-s,2)).reduce((c,h)=>c+h,0)/t.length;return Math.sqrt(r)<1e3}handleReconnection(){this.isFlapping()&&this.emit("flapping",this,this._connectionStats),this.connectedAt&&Date.now()-this.connectedAt<5e3?setTimeout(()=>this.connect(),6e4):this.connect()}get status(){return this._status}async connect(){try{this.updateConnectionStats.attempt(),this._status=0,await this.relay.connect()}catch{}}disconnect(){this._status=2,this.relay.close()}async handleNotice(t){(t.includes("oo many")||t.includes("aximum"))&&(this.disconnect(),setTimeout(()=>this.connect(),2e3),console.log(this.relay.url,"Relay complaining?",t)),this.emit("notice",this,t)}subscribe(t){const{filter:e}=t,s=this.relay.sub([e],{id:t.subId});return s.on("event",r=>{const o=new Ct(void 0,r);t.eventReceived(o,this)}),s.on("eose",()=>{t.eoseReceived(this)}),this.activeSubscriptions.add(t),t.on("close",()=>{this.activeSubscriptions.delete(t)}),s}async publish(t){const e=await t.toNostrEvent();this.relay.publish(e)}scoreSlowerEvent(t){}get connectionStats(){return this._connectionStats}},se=class extends B{constructor(t=[],e){super();g(this,"relays",new Map);g(this,"debug");this.debug=e.debug.extend("pool"),t.forEach(s=>{const r=new ne(s);r.on("notice",(o,f)=>this.emit("notice",o,f)),r.on("connect",()=>this.emit("connect",r)),r.on("disconnect",()=>this.emit("disconnect",r)),r.on("flapping",()=>this.handleFlapping(r)),this.relays.set(s,r)})}async connect(t){const e=[];this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}...`:""}`);for(const s of this.relays.values())if(t){const r=new Promise((o,f)=>{setTimeout(()=>f(`Timed out after ${t}ms`),t)});e.push(Promise.race([s.connect(),r]).catch(o=>{this.debug(`Failed to connect to relay ${s.url}: ${o}`)}))}else e.push(s.connect());await Promise.all(e)}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`),this.relays.delete(t.url),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,e.status===1?t.connected++:e.status===3?t.disconnected++:e.status===0&&t.connecting++;return t}};function re(n,t){const e=JSON.parse(n.content);return e.name&&(t.name=e.name),e.display_name&&(t.displayName=e.display_name),e.displayName&&(t.displayName=e.displayName),e.image&&(t.image=e.image),e.picture&&(t.image=e.picture),e.banner&&(t.banner=e.banner),e.bio&&(t.bio=e.bio),e.nip05&&(t.nip05=e.nip05),e.lud06&&(t.lud06=e.lud06),e.lud16&&(t.lud16=e.lud16),e.about&&(t.about=e.about),e.zapService&&(t.zapService=e.zapService),t}async function ie(){if(!this.ndk)throw new Error("NDK not set");const n=await this.ndk.fetchEvents({kinds:[3],authors:[this.hexpubkey()]});if(n){const t=new Set;return n.forEach(e=>{e.tags.forEach(s=>{if(s[0]==="p")try{const r=new at({hexpubkey:s[1]});r.ndk=this.ndk,t.add(r)}catch{}})}),t}return new Set}var at=class{constructor(n){g(this,"ndk");g(this,"profile");g(this,"npub","");g(this,"relayUrls",[]);g(this,"follows",ie.bind(this));n.npub&&(this.npub=n.npub),n.hexpubkey&&(this.npub=P.npubEncode(n.hexpubkey)),n.relayUrls&&(this.relayUrls=n.relayUrls)}static async fromNip05(n){const t=await Rt.queryProfile(n);if(t)return new at({hexpubkey:t.pubkey,relayUrls:t.relays})}hexpubkey(){return P.decode(this.npub).data}async fetchProfile(n){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});const t=await this.ndk.fetchEvents({kinds:[0],authors:[this.hexpubkey()]},n);return t&&Array.from(t).sort((s,r)=>s.created_at-r.created_at).forEach(s=>{try{this.profile=re(s,this.profile)}catch{}}),t}async relayList(){if(!this.ndk)throw new Error("NDK not set");const n=await this.ndk.fetchEvents({kinds:[10002],authors:[this.hexpubkey()]});return n||new Set}},vt=class{constructor(n,t){g(this,"relays");g(this,"debug");g(this,"ndk");this.relays=n,this.ndk=t,this.debug=t.debug.extend("relayset")}subscribeOnRelay(n,t){const e=n.subscribe(t);t.relaySubscriptions.set(n,e)}getId(){const t=Array.from(this.relays).map(e=>e.url).sort().join(",");return H.bytesToHex(Nt(t))}subscribe(n){const t=n.groupableId(),e=`${this.getId()}:${t}`;if(!e)return this.executeSubscription(n),n;const s=this.ndk.delayedSubscriptions.get(e);return s?s.push(n):(setTimeout(()=>{this.executeDelayedSubscription(e)},n.opts.groupableDelay),this.ndk.delayedSubscriptions.set(e,[n])),n}executeDelayedSubscription(n){const t=this.ndk.delayedSubscriptions.get(n);this.ndk.delayedSubscriptions.delete(n),t&&(t.length>1?this.executeSubscriptions(t):this.executeSubscription(t[0]))}executeSubscriptions(n){const t=n[0].ndk,e=new ue(t,n);this.executeSubscription(e)}executeSubscription(n){return this.debug("subscribing",{filter:n.filter}),this.relays.forEach(t=>{t.status===1&&this.subscribeOnRelay(t,n)}),n}async publish(n){this.relays.forEach(async t=>{try{await t.publish(n)}catch{}})}size(){return this.relays.size}};function oe(n,t){var s;const e=new Set;return(s=n.pool)==null||s.relays.forEach(r=>e.add(r)),new vt(e,n)}function ae(n,t){var s;const e=new Set;return(s=n.pool)==null||s.relays.forEach(r=>{r.complaining?n.debug(`Relay ${r.url} is complaining, not adding to set`):e.add(r)}),new vt(e,n)}var ce={closeOnEose:!0,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100},xt=class extends B{constructor(t,e,s,r,o){super();g(this,"subId");g(this,"filter");g(this,"opts");g(this,"relaySet");g(this,"ndk");g(this,"relaySubscriptions");g(this,"debug");g(this,"eventFirstSeen",new Map);g(this,"eosesSeen",new Set);g(this,"eoseTimeout");if(this.ndk=t,this.subId=o||Math.floor(Math.random()*9999991e3).toString(),this.filter=e,this.relaySet=r,this.opts={...ce,...s||{}},this.relaySubscriptions=new Map,this.debug=t.debug.extend("subscription"),this.opts.cacheUsage==="ONLY_CACHE"&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}groupableId(){var r,o;if(!((r=this.opts)!=null&&r.groupable))return null;const t=(((o=this.filter.kinds)==null?void 0:o.length)||0)>0,e=!this.filter.since&&!this.filter.until,s=!this.filter.limit;return t&&e&&s?this.filter.kinds.join(","):null}shouldQueryCache(){var t;return((t=this.opts)==null?void 0:t.cacheUsage)!=="ONLY_RELAY"}shouldQueryRelays(){var t;return((t=this.opts)==null?void 0:t.cacheUsage)!=="ONLY_CACHE"}async start(){var e,s;let t;if(this.shouldQueryCache()&&(t=this.startWithCache(),((e=this.ndk.cacheAdapter)==null?void 0:e.locking)&&this.shouldQueryRelays()&&((s=this.opts)==null?void 0:s.cacheUsage)!=="PARALLEL"&&(this.debug("waiting for cache to finish"),await t,this.eventFirstSeen.size>0))){this.debug("cache hit, skipping relay query"),this.emit("eose",this);return}this.shouldQueryRelays()&&this.startWithRelaySet()}stop(){this.relaySubscriptions.forEach(t=>t.unsub()),this.relaySubscriptions.clear(),this.emit("close",this)}async startWithCache(){var t;if((t=this.ndk.cacheAdapter)!=null&&t.query){this.debug("querying cache");const e=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await e}}startWithRelaySet(){this.relaySet||(this.relaySet=ae(this.ndk,this.filter)),this.relaySet&&(this.debug("querying relays"),this.relaySet.subscribe(this))}eventReceived(t,e,s=!1){if(!s&&e){if(this.eventFirstSeen.has(t.id)){const o=Date.now()-(this.eventFirstSeen.get(t.id)||0);e.scoreSlowerEvent(o),this.emit("event:dup",t,e,o,this);return}this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(t,this.filter),this.eventFirstSeen.set(`${t.id}`,Date.now())}else this.eventFirstSeen.set(`${t.id}`,0);this.emit("event",t,e,this)}eoseReceived(t){var s,r,o;(s=this.opts)!=null&&s.closeOnEose&&((r=this.relaySubscriptions.get(t))==null||r.unsub(),this.relaySubscriptions.delete(t),this.relaySubscriptions.size===0&&this.emit("close",this)),this.eosesSeen.add(t),this.eosesSeen.size===((o=this.relaySet)==null?void 0:o.size())?this.emit("eose"):(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.eoseTimeout=setTimeout(()=>{this.emit("eose")},500))}},ue=class extends xt{constructor(t,e){const s=t.debug.extend("subscription-group"),r=he(e.map(o=>o.filter));super(t,r,e[0].opts,e[0].relaySet);g(this,"subscriptions");this.subscriptions=e,s("merged filters",{count:e.length,mergedFilters:this.filter}),this.on("event",this.forwardEvent),this.on("event:dup",this.forwardEventDup),this.on("eose",this.forwardEose),this.on("close",this.forwardClose)}isEventForSubscription(t,e){const{filter:s}=e;return s?Tt(s,t.rawEvent()):!1}forwardEvent(t,e){for(const s of this.subscriptions)this.isEventForSubscription(t,s)&&s.emit("event",t,e,s)}forwardEventDup(t,e,s){for(const r of this.subscriptions)this.isEventForSubscription(t,r)&&r.emit("event:dup",t,e,s,r)}forwardEose(){for(const t of this.subscriptions)t.emit("eose",t)}forwardClose(){for(const t of this.subscriptions)t.emit("close",t)}};function he(n){const t={};return n.forEach(e=>{Object.entries(e).forEach(([s,r])=>{Array.isArray(r)?t[s]===void 0?t[s]=[...r]:t[s]=Array.from(new Set([...t[s],...r])):t[s]=r})}),t}function fe(n,t){return n.created_at>t.created_at?n:t}var le=class extends B{constructor(t={}){var e,s;super();g(this,"pool");g(this,"signer");g(this,"cacheAdapter");g(this,"debug");g(this,"delayedSubscriptions");this.debug=t.debug||J("ndk"),this.pool=new se(t.explicitRelayUrls||[],this),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.delayedSubscriptions=new Map,this.debug("initialized",{relays:t.explicitRelayUrls,signer:((e=t.signer)==null?void 0:e.constructor.name)||"none",cacheAdapter:((s=t.cacheAdapter)==null?void 0:s.constructor.name)||"none"})}async connect(t){return this.debug("Connecting to relays",{timeoutMs:t}),this.pool.connect(t)}getUser(t){const e=new at(t);return e.ndk=this,e}subscribe(t,e){const s=new xt(this,t,e);return s.start(),s}async publish(t){return oe(this).publish(t)}async fetchEvent(t,e={}){return new Promise(s=>{this.subscribe(t,{...e,closeOnEose:!0}).on("event",o=>{o.ndk=this,s(o)})})}async fetchEvents(t,e={}){return new Promise(s=>{const r=new Map,o=this.subscribe(t,{...e,closeOnEose:!0});o.on("event",f=>{const c=r.get(f.tagId());c&&(f=fe(c,f)),f.ndk=this,r.set(f.tagId(),f)}),o.on("eose",()=>{s(new Set(r.values()))})})}async assertSigner(){if(!this.signer)throw this.emit("signerRequired"),new Error("Signer required")}};const de=new le({explicitRelayUrls:["wss://purplepag.es","wss://relay.nostr.band","wss://universe.nostrich.land/?lang=zh","wss://nos.lol","wss://relay.snort.social","wss://relay.damus.io"]}),we=_t(de);export{we as n};
